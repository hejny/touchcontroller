<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sample of TouchController</title>
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="./common.css">
</head>
<body>


<canvas id="scene" width="500" height="500"></canvas>
<div id="log" width="500" height="500"></div>


<script type="text/javascript" src="../dist/touchcontroller.browser.js"></script>
<script type="text/javascript">

    var scene = document.getElementById('scene');
    var ctx = scene.getContext('2d');
    ctx.lineWidth = 10;
    ctx.lineCap = "round";


    var touchController = new TouchController.TouchController(scene);
    touchController.addListener(new TouchController.listeners.TouchListener);
    touchController.addListener(new TouchController.listeners.MouseListener);
    var multiTouchController = new TouchController.MultiTouchController(
        touchController,
        function (position) {
            return Math.round(position.x / 100);
        }
    );
    console.log(multiTouchController);

    multiTouchController.multiTouches.subscribe(function (multitouch) {

        //console.log(multitouch);

        var color = '#' + Math.floor(Math.random() * 16777215).toString(16);

        var logMultitouch = $('<div class="log-multitouch"><div class="log-title">' + multitouch + '</div></div>');
        $('#log').append(logMultitouch)

        multitouch.touches.subscribe(function (touch) {


                var logTouch = $('<div class="log-touch"><div class="log-title">' + touch + '</div></div>');
                $(logMultitouch).append(logTouch)


                touch.positions.subscribe(function (position) {

                        var lastPosition = multitouch.ongoingTouches[0].lastPosition;
                        for (var i = 1, l = multitouch.ongoingTouches.length; i < l; i++) {
                            var position = multitouch.ongoingTouches[i].lastPosition;

                            ctx.strokeStyle = color;
                            ctx.beginPath();
                            ctx.moveTo(lastPosition.x, lastPosition.y);
                            ctx.lineTo(position.x, position.y);
                            ctx.stroke();

                            lastPosition = position;
                        }


                        //console.log(multitouch.touches.toArray());

                        /*ctx.strokeStyle = color;
                        ctx.beginPath();
                        ctx.moveTo(lastPosition.x, lastPosition.y);
                        ctx.lineTo(position.x, position.y);
                        ctx.stroke();
                        lastPosition = position;*/
                    },
                    function () {
                    },
                    function () {
                        alert(123);
                        logTouch.remove();
                    }
                );

            },
            function () {
            },
            function () {
                alert(345);
                logMultitouch.remove();
            });
    });
</script>


</body>
</html>
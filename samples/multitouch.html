<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sample of TouchController</title>
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="./common.css">
</head>
<body>


<canvas id="scene" width="500" height="500"></canvas>
<div id="log" width="500" height="500"></div>


<script type="text/javascript" src="../dist/touchcontroller.browser.js"></script>
<script type="text/javascript">

    var scene = document.getElementById('scene');
    var ctx = scene.getContext('2d');
    ctx.lineWidth = 10;
    ctx.lineCap = "round";


    var touchController = new TouchController.TouchController(scene);
    var multiTouchController = new TouchController.MultiTouchController(
        touchController,
        function (position) {
            return Math.round(position.x / 100);
        }
    );
    //console.log(multiTouchController);

    //multiTouchController.multiTouches.subscribe(function (multitouch) {console.log('a1',multitouch)});
    //multiTouchController.multiTouches.subscribe(function (multitouch) {console.log('a2',multitouch)});
    multiTouchController.multiTouches.subscribe(function (multitouch) {

        //console.log(multitouch);

        var color = '#' + Math.floor(Math.random() * 16777215).toString(16);

        var logMultitouch = $('<div class="log-multitouch"><div class="log-title">' + multitouch + '</div><div class="log-multitouch-last-transformation"></div></div>');
        $('#log').append(logMultitouch)


        //multitouch.touches.subscribe(function (touch) {console.log('b1',touch)});
        //multitouch.touches.subscribe(function (touch) {console.log('b2',touch)});


        multitouch.transformations().subscribe(function (transformation) {
            $(logMultitouch).find('.log-multitouch-last-transformation').html(`
                        <table>
                            <tr>
                                <th>Translate:</th>
                                <td>${transformation.translate}</td>
                            </tr>
                            <tr>
                                <th>Rotate:</th>
                                <td>${transformation.rotate}</td>
                            </tr>
                            <tr>
                                <th>Scale:</th>
                                <td>${transformation.scale}</td>
                            </tr>
                        </table>
                    `);

        });

        multitouch.touches.subscribe(function (touch) {

                //touch.frames.subscribe(function (frame) {console.log('c1',frame)});
                //touch.frames.subscribe(function (frame) {console.log('c2',frame)});


                var logTouch = $('<div class="log-touch"><div class="log-title">' + touch + '</div><div class="log-touch-frames"></div><div class="log-touch-last-frame"></div></div></div>');
                $(logMultitouch).append(logTouch);
                var framesCounter = 0;


                touch.frames.subscribe(function (frame) {

                    $(logTouch).find('.log-touch-frames').text(framesCounter++);
                    $(logTouch).find('.log-touch-last-frame').html(`
                        <table>
                            <tr>
                                <th>Position:</th>
                                <td>${frame.position}</td>
                            </tr>
                            <tr>
                                <th>Time:</th>
                                <td>${frame.time}</td>
                            </tr>
                            <tr>
                                <th>Rotation:</th>
                                <td>${frame.rotation}</td>
                            </tr>
                            <tr>
                                <th>Scale:</th>
                                <td>${frame.scale}</td>
                            </tr>
                            <tr>
                                <th>Force:</th>
                                <td>${frame.force}</td>
                            </tr>
                            <tr>
                                <th>Radius:</th>
                                <td>${frame.radius}</td>
                            </tr>
                        </table>
                    `);

                        /*var lastFrame = multitouch.ongoingTouches[0].lastFrame;
                        for (var i = 1, l = multitouch.ongoingTouches.length; i < l; i++) {
                            var position = multitouch.ongoingTouches[i].lastFrame;

                            ctx.strokeStyle = color;
                            ctx.beginPath();
                            ctx.moveTo(lastFrame.x, lastFrame.y);
                            ctx.lineTo(position.x, position.y);
                            ctx.stroke();

                            lastFrame = position;
                        }*/

                    },
                    function () {
                    },
                    function () {
                        logTouch.remove();
                    }
                );

            },
            function () {
            },
            function () {
                logMultitouch.remove();
            });
    });
</script>


</body>
</html>
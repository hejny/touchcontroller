<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Sample of TC (ES6)</title>
        <link rel="stylesheet" type="text/css" href="./common.css" />
    </head>
    <body>
        <canvas id="scene" width="500" height="500"></canvas>

        <script
            type="text/javascript"
            src="../dist/main.dev.browser.js"
        ></script>
        <script type="text/javascript">
            const TC = TouchController;
            const scene = document.getElementById('scene');
            const ctx = scene.getContext('2d');

            const rects = [
                new TC.CanvasRectangle({
                    color: 'blue',
                    transform: {
                        translate: TC.Vector.fromArray(100, 100),
                        scale: TC.Vector.fromArray(100, 150),
                        rotate: Math.PI / 10,
                    },
                }),
                new TC.CanvasRectangle({
                    color: 'green',
                    transform: {
                        translate: TC.Vector.fromArray(300, 300),
                        scale: TC.Vector.fromArray(200, 200),
                    },
                }),
            ];

            function render() {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                for (const rect of rects.slice().reverse()) {
                    rect.render(ctx);
                }
                requestAnimationFrame(render);
            }
            render();

            const touchController = new TC.TouchController.fromCanvas(scene);
            const multiTouchController = new TC.MultiTouchController(
                touchController,
                (frame) =>
                    rects.find((rect) => rect.intersects(frame.position)),
            );

            multiTouchController.hoveredElementsChanges.subscribe(
                ([elementNew, elementOld]) => {
                    if (elementNew || false) {
                        elementNew.hovered = true;
                    }
                    if (elementOld || false) {
                        elementOld.hovered = false;
                    }
                },
            );

            multiTouchController.multiTouches.subscribe(function (multitouch) {
                if (typeof multitouch.element === 'undefined') return;
                const rect = multitouch.element;
                const sizeRatio = rect.size.y / rect.size.x;
                multitouch.transforms(multitouch.element).subscribe(
                    function (transformation) {},
                    function () {},
                    function () {
                        if (multitouch.empty) {
                            rect.rotation += (Math.PI * 2) / 36;
                        }
                    },
                );
            });
        </script>
    </body>
</html>
